{% extends "layout.html" %}

{% block extra_css %}
<style>
        /* Grid layout for product cards */
        .product-grid {
            display: grid;
            gap: 18px;
            grid-template-columns: repeat(auto-fill, minmax(340px, 1fr));
        }

        /* Individual product card */
        .card {
            background: rgba(255,255,255,0.12);
            border: 1px solid rgba(255,255,255,0.28);
            border-radius: 16px;
            backdrop-filter: blur(10px); 
            -webkit-backdrop-filter: blur(10px);
            padding: 12px;
            display: flex; 
            flex-direction: column; 
            gap: 10px;
            transition: transform .15s ease, box-shadow .15s ease;
            cursor: pointer;
        }

        .card:hover {
            transform: translateY(-2px);
            box-shadow: 0px 10px 24px rgba(0,0,0,.12);
        }

        /* Product image container */
        .thumb {
            position: relative;
            aspect-ratio: 4/3;
            overflow: hidden;
            border-radius: 12px;
            background: linear-gradient(35deg, #eff3ff, #e6ecff);
            display: grid;
            place-items: center;
            color: #6371a6;
            font-weight: 700;
        }

        .thumb img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
        }

        .title {
            margin: 4px 2px 0; 
            font-size: 16px; 
            color: #000; 
            font-weight: 700;
        }

        .meta { 
            margin: 0 2px; 
            font-size: 13px; 
            color: rgba(0,0,0,.85); 
        }

        /* Price + action row */
        .row {
            display: flex; 
            align-items: center; 
            justify-content: space-between; 
            gap: 10px; 
            margin-top: 4px;
        }

        .price {
            color: #000; 
            font-weight: 800; 
            font-size: 18px;
        }

        .btn {
            border:0; 
            background:var(--primary); 
            color:#fff; 
            padding:8px 12px; 
            border-radius:10px; 
            font-weight:600; 
            cursor:pointer;
        }

        .btn:hover {
            background: var(--primary-600);
        }

        /* Shown when no products are available */
        .empty-state{
            text-align:center;
            padding: 60px 20px;
            color:#6b7280;
            background: rgba(255,255,255,0.65);
            border:1px solid rgba(0,0,0,0.06);
            border-radius:16px;
        }
        .empty-state h3{
            margin:0 0 8px;
            font-size:22px;
            color:#111827;
        }
        .empty-state p{
            margin:0;
            font-size:14px;
        }

        /* Mobile responsiveness */
        @media (max-width: 720px) {
            main.page {
                padding: 40px 20px 40px;
                width: min(80vw, 800px); 
                margin: calc(var(--navbar-h) + 32px) auto 32px;
            }

            .section-title {
                margin: 0 0 12px;
                text-align: center;
            }

            .product-grid {
                grid-template-columns: 1fr;
                justify-items: center;
            }

            .card {
                width: 90%;
                max-width: 450px;  
            }
        }
</style>
{% endblock %}

{% block body %}
    <main class="page">
        <h2 class="section-title">Latest items</h2>

        {# Show product grid only if products exist #}
        {% if products %}
            <section class="product-grid">
                {% for p in products %}
                    <!-- Clicking the card navigates to the product detail page -->
                    <div class="card"
                         data-url="{{ url_for('product_detail', product_id=p['id']) }}"
                         onclick="window.location.href = this.dataset.url;"
                         style="cursor: pointer;">
                         
                        <div class="thumb">
                            {% if p['main_image'] %}
                                <img src="{{ p['main_image'] }}" alt="{{ p['title'] }}">
                            {% else %}
                                No image
                            {% endif %}
                        </div>

                        <h3 class="title">{{ p["title"] }}</h3>

                        <p class="meta">
                            {{ p["condition"] }}
                            {% if p["color"] %} | {{ p["color"] }}{% endif %}
                            {% if p["category"] %} | {{ p["category"] }}{% endif %}
                        </p>

                        <div class="row">
                            <span class="price">${{ "%.2f"|format(p["price"]) }}</span>

                            <!-- Stop click propagation so Add to Cart doesn't trigger card navigation -->
                            <form action="{{ url_for('cart_add', product_id=p['id'])}}" method="post">
                                <button
                                    class="btn"
                                    type="submit"
                                    onclick="event.stopPropagation();">
                                    Add to Cart
                                </button>
                            </form>
                        </div>
                    </div>
                {% endfor %}
            </section>
        {% else %}
            <!-- Empty state for search results or no products -->
            <div class="empty-state">
                <h3>No items found</h3>
                {% if q %}
                    <p>We couldnâ€™t find anything matching <b>"{{ q }}"</b>.</p>
                {% else %}
                    <p>No products available right now.</p>
                {% endif %}
            </div>
        {% endif %}
    </main>
{% endblock %}